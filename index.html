<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background-color: #030303; 
            color: #ffffff; 
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useRef } = React;

        function CameraApp() {
            const [useCamera, setUseCamera] = useState(false);
            const videoRef = useRef(null);
            const streamRef = useRef(null);

            const startCamera = async () => {
                try {
                    console.log("START CAMERA CALLED");
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'user' } 
                    });
                    console.log("Stream obtained:", stream);
                    
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        streamRef.current = stream;
                        setUseCamera(true);
                        console.log("Camera started successfully");
                    }
                } catch (error) {
                    console.error('Camera error:', error);
                    alert('Camera error: ' + error.message);
                }
            };

            const stopCamera = () => {
                try {
                    if (streamRef.current) {
                        streamRef.current.getTracks().forEach(t => t.stop());
                        streamRef.current = null;
                    }
                    if (videoRef.current) {
                        videoRef.current.srcObject = null;
                    }
                    setUseCamera(false);
                    console.log("Camera stopped");
                } catch (error) {
                    console.error('Error stopping camera:', error);
                }
            };

            const capturePhoto = () => {
                try {
                    if (!videoRef.current) {
                        alert('Video not ready');
                        return;
                    }
                    const canvas = document.createElement('canvas');
                    canvas.width = videoRef.current.videoWidth;
                    canvas.height = videoRef.current.videoHeight;
                    canvas.getContext('2d').drawImage(videoRef.current, 0, 0);
                    const img = canvas.toDataURL('image/jpeg');
                    console.log("Photo captured");
                    alert("Photo captured! Check console.");
                    stopCamera();
                } catch (error) {
                    console.error('Capture error:', error);
                    alert('Error: ' + error.message);
                }
            };

            return (
                <div className="min-h-screen bg-black flex items-center justify-center p-4">
                    <div className="w-full max-w-md">
                        <h1 className="text-4xl font-bold text-center mb-8 text-indigo-400">
                            Camera Test
                        </h1>

                        {/* Status Box */}
                        <div className="bg-indigo-900/30 border border-indigo-500/50 p-4 rounded-lg mb-6">
                            <p className="text-sm">Camera Status: <span className="font-bold text-lg">{useCamera ? '‚úÖ OPEN' : '‚ùå CLOSED'}</span></p>
                        </div>

                        {/* Camera View or Upload Area */}
                        <div className="bg-gray-900 rounded-lg overflow-hidden mb-6 border border-gray-700">
                            {useCamera ? (
                                <div>
                                    <video 
                                        ref={videoRef} 
                                        autoPlay 
                                        playsInline 
                                        muted 
                                        className="w-full bg-black"
                                        style={{ aspectRatio: '4/3', transform: 'scaleX(-1)' }}
                                    />
                                </div>
                            ) : (
                                <div className="w-full bg-black flex items-center justify-center" style={{ aspectRatio: '4/3' }}>
                                    <p className="text-gray-500 text-center">Camera is closed</p>
                                </div>
                            )}
                        </div>

                        {/* Buttons */}
                        <div className="space-y-3">
                            {!useCamera ? (
                                <button
                                    onClick={startCamera}
                                    className="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg transition-colors"
                                >
                                    üì∑ Open Camera
                                </button>
                            ) : (
                                <>
                                    <button
                                        onClick={capturePhoto}
                                        className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition-colors"
                                    >
                                        üì∏ Capture Photo
                                    </button>
                                    <button
                                        onClick={stopCamera}
                                        className="w-full py-4 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg transition-colors"
                                    >
                                        ‚úï Close Camera
                                    </button>
                                </>
                            )}
                        </div>

                        <p className="text-xs text-gray-500 text-center mt-6">
                            Open browser console (F12) to see debug messages
                        </p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CameraApp />);
    </script>
</body>
</html>
